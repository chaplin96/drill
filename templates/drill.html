<!DOCTYPE html>
<html lang="ja">

<head prefix="og: http://ogp.me/ns#">
    <meta charset="UTF-8">
    <title>å¤§å–œåˆ©ãƒ‰ãƒªãƒ«</title>

    <!-- Google tag (gtag.js) -->

    <!-- OGP -->
    <meta property="og:title" content="å¤§å–œåˆ©ãƒ‰ãƒªãƒ«">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://faniest.com">
    <meta property="og:description" content="å¤§å–œåˆ©ãƒ‰ãƒªãƒ«">
    <link rel="stylesheet" href="/static/css/drill.css">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <!-- pwa -->
    <meta name="theme-color" content="#317EFB" />
    <link rel="icon" href="{{url_for('static', filename='icons/192x192.png')}}" type="image/png">
    <link rel="apple-touch-icon" href="{{url_for('static', filename='icons/192x192.png')}}" type="image/png">
    <link rel="manifest" href="/manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register("/sw.js").then(function (registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function (err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</head>

<body>
    <div class="main" id="main">
        <div class="timer-box">
            <div class="timer-icon">â±</div>
            <div class="timer" id="timer">2:00</div>
        </div>

        <div class="question" id="question"></div>
        <div class="answer-box">
            <textarea id="answer-input" class="answer-input" placeholder="å›ç­”æ¬„" rows="5"></textarea>
        </div>

        <div class="btn-container">
            <a href="oogiri/drill" class="btn" id="answer-btn">å›ç­”</a>
        </div>

        <div class="reaction" id="reaction"></div>

        <div>ï¼œå›ç­”å±¥æ­´ï¼</div>
        <div class="answer-history" id="answer-history"></div>

        <div class="comment-container" id="comment-container"></div>
        <div class="btn-container" id="next-btn-container"></div>

        <div class="popup-overlay">
            <div class="popup-window">
                <div class="popup-text">ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼<br>ãŠç–²ã‚Œæ§˜ğŸ˜Š</div>
            </div>
        </div>

    </div>


    <script type="text/javascript">
        const oogiri = {{ oogiri | tojson }};

        // å¤‰æ•°ã®åˆæœŸåŒ–
        const answerButton = document.querySelector('.btn');
        const answerHistory = document.getElementById('answer-history');
        const reaction = document.getElementById('reaction');


        const question = document.getElementById('question');
        const commentContainer = document.getElementById('comment-container');

        question.textContent = oogiri.question;
        commentContainer.innerHTML = '';
        answerHistory.innerHTML = '';
        answerButton.classList.remove('disabled');
        reaction.innerHTML = '';

        // ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­ç½®
        const timer = document.getElementById('timer');
        let time = 120;
        let timerId = setInterval(() => {
            time--;
            timer.textContent = `${Math.floor(time / 60)}:${String(time % 60).padStart(2, '0')}`;
            if (time === 0) {
                clearInterval(timerId);

                // ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
                const popupOverlay = document.querySelector('.popup-overlay');
                popupOverlay.style.display = 'block';

                // 1ç§’å¾Œã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’æ¶ˆã™
                setTimeout(() => {
                    popupOverlay.style.display = 'none';
                }, 1000);


                // å›ç­”ãƒœã‚¿ãƒ³ã‚’disabledã«ã™ã‚‹
                answerButton.classList.add('disabled');


                // ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤º
                const commentBox = document.createElement('div');
                commentBox.classList.add('comment-box');

                const comment = document.createElement('div');
                comment.classList.add('comment');
                commentBox.appendChild(comment);

                const answerSampleTitle = document.createElement('div');
                answerSampleTitle.textContent = '(å›ç­”ä¾‹)';
                commentBox.appendChild(answerSampleTitle);

                // anwer_samplesã‚’è¡¨ç¤ºã™ã‚‹
                oogiri.answer_samples.forEach((answer_sample) => {
                    const answerSample = document.createElement('li');
                    answerSample.textContent = answer_sample;
                    commentBox.appendChild(answerSample);
                });
                commentContainer.appendChild(commentBox);

                // ã‚‚ã†ä¸€å›ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                const nextButton = document.createElement('a');
                nextButton.textContent = 'æ¬¡ã®å•é¡Œ';
                nextButton.setAttribute('href', '/oogiri/drill');
                nextButton.classList.add('btn');
                // nextButton.addEventListener('click', () => {
                //     if (qi === oogiriList.length - 1) {
                //         // çµ‚äº†ç”»é¢ã¸é·ç§»
                //         window.location.href = '/oogiri/finish';
                //     } else {
                //         qi += 1;
                //         displayOogiri(oogiriList[qi]);
                //         nextButton.remove();
                //     }
                // });
                const nextButtonContainer = document.getElementById('next-btn-container');
                nextButtonContainer.appendChild(nextButton);

            }
        }, 1000);


        //  å›ç­”ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰å›ç­”å±¥æ­´ã«è¿½åŠ ã™ã‚‹
        answerButton.addEventListener('click', () => {
            event.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒªãƒ³ã‚¯å‹•ä½œã‚’é˜»æ­¢

            // å›ç­”ãƒœã‚¿ãƒ³æŠ¼ã™åº¦ã«ç¬‘ã£ãŸçµµæ–‡å­—ãŒå‡ºã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            reaction.textContent += 'ğŸ¤£';
            reaction.classList.remove('fadeout');
            // 1ç§’å¾Œã«çµµæ–‡å­—ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            setTimeout(() => {
                reaction.classList.add('fadeout');
            }, 1000);


            const answerInput = document.getElementById('answer-input');
            const newAnswer = document.createElement('div');
            newAnswer.textContent = answerInput.value;
            answerHistory.appendChild(newAnswer);
            answerInput.value = '';

        });



    </script>

</body>